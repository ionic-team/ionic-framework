<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <title>Toast - Hue</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <link href="../../../../../css/ionic.bundle.css" rel="stylesheet" />
    <link href="../../../../../scripts/testing/styles.css" rel="stylesheet" />
    <script src="../../../../../scripts/testing/scripts.js"></script>
    <script nomodule src="../../../../../dist/ionic/ionic.js"></script>
    <script type="module" src="../../../../../dist/ionic/ionic.esm.js"></script>
  </head>

  <script type="module">
    import { toastController } from '../../../../dist/ionic/index.esm.js';
    window.toastController = toastController;
  </script>

  <body>
    <ion-app>
      <ion-header>
        <ion-toolbar>
          <ion-title>Toast - Hue</ion-title>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding" id="content">
        <p>
          Toasts are presented indefinitely but can be closed by clicking the backdrop. The backdrop has been added for
          demo purposes only.
        </p>

        <button class="expand" onclick="openAllToasts(false)">Show All Subtle Toasts</button>
        <button class="expand" onclick="openAllToasts(true)">Show All Bold Toasts</button>
      </ion-content>

      <div id="toastBackdrop" class="backdrop"></div>
    </ion-app>

    <script>
      const colorIconMap = {
        primary: { color: 'primary', icon: 'alert-circle' },
        secondary: { color: 'secondary', icon: 'information-circle' },
        tertiary: { color: 'tertiary', icon: 'alert-circle' },
        success: { color: 'success', icon: 'checkmark-circle' },
        warning: { color: 'warning', icon: 'warning' },
        danger: { color: 'danger', icon: 'alert-circle' },
        light: { color: 'light', icon: 'alert-circle' },
        medium: { color: 'medium', icon: 'alert-circle' },
        dark: { color: 'dark', icon: 'alert-circle' },
      };
      let toastCount = 0;
      let activeToasts = [];

      // Show backdrop when toasts are presented
      function showBackdrop() {
        const backdrop = document.getElementById('toastBackdrop');
        backdrop.style.display = 'block';
        backdrop.addEventListener('click', closeAllToasts);
      }

      // Hide backdrop when all toasts are dismissed
      function hideBackdrop() {
        const backdrop = document.getElementById('toastBackdrop');
        if (toastCount === 0) {
          backdrop.style.display = 'none';
          backdrop.removeEventListener('click', closeAllToasts);
        }
      }

      // Close all toasts when the backdrop is clicked
      function closeAllToasts() {
        activeToasts.forEach((toast) => {
          toast.dismiss();
        });
        toastCount = 0;
        activeToasts = [];
        hideBackdrop();
      }

      async function openToast(opts, delay = 0) {
        setTimeout(async () => {
          const yOffset = toastCount * 60;
          toastCount++;

          const toast = await toastController.create({
            ...opts,
            position: 'top',
            animated: false,
          });

          await toast.present();
          activeToasts.push(toast);

          showBackdrop();

          requestAnimationFrame(() => {
            const toastEl = document.querySelector('ion-toast:last-of-type');
            if (toastEl) {
              toastEl.style.position = 'absolute';
              toastEl.style.left = '50%';
              toastEl.style.transform = 'translateX(-50%)';
              toastEl.style.top = `${10 + yOffset}px`;
            }
          });

          toast.onDidDismiss().then(() => {
            toastCount--;
            activeToasts = activeToasts.filter((t) => t !== toast);
            hideBackdrop();
          });
        }, delay);
      }

      // Show all toasts sequentially with a slight delay between each
      function openAllToasts(isBold) {
        toastCount = 0;
        activeToasts = [];

        Object.values(colorIconMap).forEach((item, index) => {
          openToast(
            {
              message: `This is a ${item.color} toast.`,
              buttons: [{ text: 'Action' }, { icon: 'close', role: 'cancel' }],
              color: item.color,
              icon: item.icon,
              ...(isBold ? { hue: 'bold' } : {}),
            },
            index * 150
          );
        });
      }
    </script>

    <style>
      .backdrop {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: none;
        z-index: 9998;
        pointer-events: all;
        backdrop-filter: blur(5px);
      }
    </style>
  </body>
</html>
