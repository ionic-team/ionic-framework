// Set the theme colors map to be used by the color functions
// --------------------------------------------------------------------------------------------
@mixin set-theme-colors($colorsMap) {
  $theme-colors: $colorsMap !global;
}

// Gets the active color's css variable from a variation. Alpha is optional.
// --------------------------------------------------------------------------------------------
// Example usage:
// current-color(base) => var(--ion-color-base)
// current-color(contrast, 0.1) => rgba(var(--ion-color-contrast-rgb), 0.1)
// --------------------------------------------------------------------------------------------
@function current-color($variation, $alpha: null) {
  @if $alpha == null {
    @return var(--ion-color-#{$variation});
  } @else {
    @return rgba(var(--ion-color-#{$variation}-rgb), #{$alpha});
  }
}

// Gets the specific color's css variable from the name and variation. Alpha/rgb are optional.
// --------------------------------------------------------------------------------------------
// Example usage:
// ion-color(primary, base) => var(--ion-color-primary, #3880ff)
// ion-color(secondary, contrast) => var(--ion-color-secondary-contrast)
// ion-color(primary, base, 0.5) => rgba(var(--ion-color-primary-rgb, 56, 128, 255), 0.5)
// --------------------------------------------------------------------------------------------
@function ion-color($name, $variation, $alpha: null, $rgb: null) {
  @if not($theme-colors) {
    @error 'No theme colors set. Please make sure to call set-theme-colors($colorsMap) before using ion-color()';
  }

  $values: map-get($theme-colors, $name);
  $value: map-get($values, $variation);
  $variable: --ion-color-#{$name}-#{$variation};

  @if ($variation == base) {
    $variable: --ion-color-#{$name};
  }

  @if ($alpha) {
    $value: color-to-rgb-list($value);

    @return rgba(var(#{$variable}-rgb, $value), $alpha);
  }

  @if ($rgb) {
    $value: color-to-rgb-list($value);
    $variable: #{$variable}-rgb;
  }

  @return var(#{$variable}, $value);
}

// Mixes a color with black to create its shade.
// --------------------------------------------------------------------------------------------
@function get-color-shade($color) {
  @if (type-of($color) != color) {
    @return $color;
  }
  @return mix(#000, $color, 12%);
}

// Mixes a color with white to create its tint.
// --------------------------------------------------------------------------------------------
@function get-color-tint($color) {
  @if (type-of($color) != color) {
    @return $color;
  }
  @return mix(#fff, $color, 10%);
}

// Converts a color to a comma separated rgb.
// --------------------------------------------------------------------------------------------
@function color-to-rgb-list($color) {
  @if (type-of($color) != color) {
    @return $color;
  }
  @return #{red($color)}, #{green($color)}, #{blue($color)};
}

// Generates the color classes and variables
// based on the colors map
// --------------------------------------------------------------------------------------------
@mixin generate-color($color-name) {
  @if not($theme-colors) {
    @error 'No theme colors set. Please make sure to call set-theme-colors($colorsMap) before using ion-color()';
  }

  $value: map-get($theme-colors, $color-name);

  $base: map-get($value, base);
  $contrast: map-get($value, contrast);
  $shade: map-get($value, shade);
  $tint: map-get($value, tint);
  $subtle: map-get($value, subtle);

  --ion-color-base: var(--ion-color-#{$color-name}, #{$base}) !important;
  --ion-color-base-rgb: var(--ion-color-#{$color-name}-rgb, #{color-to-rgb-list($base)}) !important;
  --ion-color-contrast: var(--ion-color-#{$color-name}-contrast, #{$contrast}) !important;
  --ion-color-contrast-rgb: var(--ion-color-#{$color-name}-contrast-rgb, #{color-to-rgb-list($contrast)}) !important;
  --ion-color-shade: var(--ion-color-#{$color-name}-shade, #{$shade}) !important;
  --ion-color-tint: var(--ion-color-#{$color-name}-tint, #{$tint}) !important;
  --ion-color-subtle: var(--ion-color-#{$color-name}-subtle, #{$subtle}) !important;
}

// Generates the CSS variables for each color
// based on the colors map
// --------------------------------------------------------------------------------------------
@mixin generate-color-variables() {
  @if not($theme-colors) {
    @error 'No theme colors set. Please make sure to call set-theme-colors($colorsMap) before using ion-color()';
  }

  @each $color-name, $value in $theme-colors {
    --ion-color-#{$color-name}: #{map-get($value, base)};
    --ion-color-#{$color-name}-rgb: #{color-to-rgb-list(map-get($value, base))};
    --ion-color-#{$color-name}-contrast: #{map-get($value, contrast)};
    --ion-color-#{$color-name}-contrast-rgb: #{color-to-rgb-list(map-get($value, contrast))};
    --ion-color-#{$color-name}-shade: #{map-get($value, shade)};
    --ion-color-#{$color-name}-tint: #{map-get($value, tint)};
  }
}
