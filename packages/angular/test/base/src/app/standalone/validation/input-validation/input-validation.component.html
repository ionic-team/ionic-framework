<ion-header>
  <ion-toolbar>
    <ion-title>Input - Validation Test</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="validation-info">
    <h2>Screen Reader Testing Instructions:</h2>
    <ol>
      <li>Enable your screen reader (VoiceOver, NVDA, JAWS, etc.)</li>
      <li>Tab through the form fields</li>
      <li>When you tab away from an empty required field, the error should be announced immediately</li>
      <li>The error text should be announced BEFORE the next field is announced</li>
      <li>Test in Chrome, Safari, and Firefox to verify consistent behavior</li>
    </ol>
  </div>

  <form [formGroup]="form">
    <div class="grid">
      <div>
        <h2>Required Email Field</h2>
        <ion-input
          #emailInput
          id="email-input"
          type="email"
          label="Email"
          labelPlacement="floating"
          fill="outline"
          placeholder="Enter your email"
          [helperText]="fieldMetadata.email.helperText"
          [errorText]="fieldMetadata.email.errorText"
          formControlName="email"
          required
          [class.ion-touched]="isTouched('email')"
          [class.ion-invalid]="isInvalid('email')"
          [class.ion-valid]="isValid('email')"
          (ionBlur)="onIonBlur('email', emailInput)"
          (ionInput)="onIonInput('email', emailInput)"
          (focusout)="onFocusOut('email', emailInput)"
        ></ion-input>
      </div>

      <div>
        <h2>Required Name Field</h2>
        <ion-input
          #nameInput
          id="name-input"
          type="text"
          label="Full Name"
          labelPlacement="floating"
          fill="outline"
          placeholder="Enter your full name"
          [helperText]="fieldMetadata.name.helperText"
          [errorText]="fieldMetadata.name.errorText"
          formControlName="name"
          required
          [class.ion-touched]="isTouched('name')"
          [class.ion-invalid]="isInvalid('name')"
          [class.ion-valid]="isValid('name')"
          (ionBlur)="onIonBlur('name', nameInput)"
          (ionInput)="onIonInput('name', nameInput)"
          (focusout)="onFocusOut('name', nameInput)"
        ></ion-input>
      </div>

      <div>
        <h2>Phone Number (Pattern Validation)</h2>
        <ion-input
          #phoneInput
          id="phone-input"
          type="tel"
          label="Phone"
          labelPlacement="floating"
          fill="outline"
          placeholder="(555) 555-5555"
          pattern="^\(\d{3}\) \d{3}-\d{4}$"
          [helperText]="fieldMetadata.phone.helperText"
          [errorText]="fieldMetadata.phone.errorText"
          formControlName="phone"
          required
          [class.ion-touched]="isTouched('phone')"
          [class.ion-invalid]="isInvalid('phone')"
          [class.ion-valid]="isValid('phone')"
          (ionBlur)="onIonBlur('phone', phoneInput)"
          (ionInput)="onIonInput('phone', phoneInput)"
          (focusout)="onFocusOut('phone', phoneInput)"
        ></ion-input>
      </div>

      <div>
        <h2>Password (Min Length)</h2>
        <ion-input
          #passwordInput
          id="password-input"
          type="password"
          label="Password"
          labelPlacement="floating"
          fill="outline"
          placeholder="Enter password"
          minlength="8"
          [helperText]="fieldMetadata.password.helperText"
          [errorText]="fieldMetadata.password.errorText"
          formControlName="password"
          required
          [class.ion-touched]="isTouched('password')"
          [class.ion-invalid]="isInvalid('password')"
          [class.ion-valid]="isValid('password')"
          (ionBlur)="onIonBlur('password', passwordInput)"
          (ionInput)="onIonInput('password', passwordInput)"
          (focusout)="onFocusOut('password', passwordInput)"
        ></ion-input>
      </div>

      <div>
        <h2>Age (Number Range)</h2>
        <ion-input
          #ageInput
          id="age-input"
          type="number"
          label="Age"
          labelPlacement="floating"
          fill="outline"
          placeholder="Enter your age"
          min="18"
          max="120"
          [helperText]="fieldMetadata.age.helperText"
          [errorText]="fieldMetadata.age.errorText"
          formControlName="age"
          required
          [class.ion-touched]="isTouched('age')"
          [class.ion-invalid]="isInvalid('age')"
          [class.ion-valid]="isValid('age')"
          (ionBlur)="onIonBlur('age', ageInput)"
          (ionInput)="onIonInput('age', ageInput)"
          (focusout)="onFocusOut('age', ageInput)"
        ></ion-input>
      </div>

      <div>
        <h2>Optional Field (No Validation)</h2>
        <ion-input
          #optionalInput
          id="optional-input"
          type="text"
          label="Optional Info"
          labelPlacement="floating"
          fill="outline"
          placeholder="This field is optional"
          [helperText]="fieldMetadata.optional.helperText"
          formControlName="optional"
          [class.ion-touched]="isTouched('optional')"
          [class.ion-invalid]="isInvalid('optional')"
          [class.ion-valid]="isValid('optional')"
          (ionBlur)="onIonBlur('optional', optionalInput)"
          (ionInput)="onIonInput('optional', optionalInput)"
          (focusout)="onFocusOut('optional', optionalInput)"
        ></ion-input>
      </div>
    </div>
  </form>

  <div class="ion-padding">
    <ion-button id="submit-btn" expand="block" [disabled]="!isFormValid()" (click)="onSubmit()">Submit Form</ion-button>
    <ion-button id="reset-btn" expand="block" fill="outline" (click)="onReset()">Reset Form</ion-button>
  </div>

  <!-- Hidden region for debugging screen reader announcements -->
  <div aria-live="polite" aria-atomic="true" class="aria-live-region" id="debug-region" #debugRegion></div>
</ion-content>
